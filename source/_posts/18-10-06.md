---
title: Hexo Next5.x 升级6.x 
date: 2018-10-06 12:53:31
tags: [Hexo]
categories: Hexo
description: Hexo Next5.x 升级6.x 
keywords: [HEXO,Next5.x 升级6.x]
---
今天开通了阅读次数和评论功能，也添加上了Top榜。
<!-- more -->
****************
本文记录一下本人升级到6.x时遇到的问题以及解决办法。
在next目录中的package.json 可以查看版本信息等...

首先下载 [next 6.x](https://github.com/theme-next/hexo-theme-next) 下载压缩包。解压并重名为 next ，放入 themes 目录。
把之前的next文件改名为next5
主要是为了区分版本，可以随时改回5.x版本。
*************************

## 在更新或者安装Hexo时报错
错误如下：
```
npm ERR! path C:\Users\10167\AppData\Roaming\npm\node_modules\hexo-cli\node_modules\has-value\node_modules\isobject
npm ERR! code ENOENT
npm ERR! errno -4058
npm ERR! syscall access
npm ERR! enoent ENOENT: no such file or directory, access 'C:\Users\10167\AppData\Roaming\npm\node_modules\hexo-cli\node_modules\has-value\node_modules\isobject'
npm ERR! enoent This is related to npm not being able to find a file.
npm ERR! enoent

npm ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\10167\AppData\Roaming\npm-cache\_logs\2018-10-08T03_48_08_101Z-debug.log
```
__问题原因为(疑是)__：`npm官方镜像连不通的问题`。
__解决方法__：
使用淘宝镜像[http://npm.taobao.org/](http://npm.taobao.org/)

```
 npm config set registry "https://registry.npm.taobao.org" //将npm包源指向淘宝
 //然后使用
 cnpm install -g hexo
 
```
***************************************************************************
一切OK， 现在美化一下博客。
## 简体中文
在 NexT 6 中，简体中文的名称变为 zh-CN ，因此在 博客配置文件 里需要将原有的：
```
language: zh-Hans
# 改为
language: zh-CN
```

## 背景动画Canvas_nest设置无效的解决方案
进入`theme/next`目录 执行命令：
```
git clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest
```
这时将配置文件_config.yml中的canvas_nest: false改为canvas_nest: true才能真正生效。
如果要使用`JavaScript 3D library`
则执行下面命令
```
git clone https://github.com/theme-next/theme-next-three source/lib/canvas-nest
```
而后设置相应的动画效果为true即可：
```
# three_waves
three_waves: false # 海浪
# canvas_lines
canvas_lines: false # 长线
# canvas_sphere
canvas_sphere: false # 爆炸
```

## 站点建立时间

打开`themes/next/`下的`_config.yml`，查找`since`
```
footer:
  # Specify the date when the site was setup.
  # If not defined, current year will be used.
  #since: 2015  #设置为自己想设置的时间
```

## 设置头像

打开`themes/next/`下的`_config.yml`，查找`avatar`
```
# Sidebar Avatar
# in theme directory(source/images): /images/avatar.gif
# in site  directory(source/uploads): /uploads/avatar.gif
avatar: http://XXXXXXXXX
```

`avatar`的值是图片的链接地址(完整的URI 或者 站内的相对地址皆可)
将图片放至`themes/next/source/images/`配置为：`avatar: /images/图片名`;

## 文章底部带#号的标签

修改模板`/themes/next/layout/_macro/post.swig`，搜索 `rel="tag">#`，将`#`换成`<i class="fa fa-tag"></i>`
如果刷新无效的话执行命令`hexo clean`后在执行`hexo s`即可。

## 点击出现桃心效果

复制代码
```
!function(e,t,a){function n(){c(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),o(),r()}function r(){for(var e=0;e<d.length;e++)d[e].alpha<=0?(t.body.removeChild(d[e].el),d.splice(e,1)):(d[e].y--,d[e].scale+=.004,d[e].alpha-=.013,d[e].el.style.cssText="left:"+d[e].x+"px;top:"+d[e].y+"px;opacity:"+d[e].alpha+";transform:scale("+d[e].scale+","+d[e].scale+") rotate(45deg);background:"+d[e].color+";z-index:99999");requestAnimationFrame(r)}function o(){var t="function"==typeof e.onclick&&e.onclick;e.onclick=function(e){t&&t(),i(e)}}function i(e){var a=t.createElement("div");a.className="heart",d.push({el:a,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:s()}),t.body.appendChild(a)}function c(e){var a=t.createElement("style");a.type="text/css";try{a.appendChild(t.createTextNode(e))}catch(t){a.styleSheet.cssText=e}t.getElementsByTagName("head")[0].appendChild(a)}function s(){return"rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"}var d=[];e.requestAnimationFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}}(),n()}(window,document);
```
在`/themes/next/source/js/src`里面新建`love.js`把代码粘贴进来，然后在`\themes\next\layout\_layout.swig`文件末尾添加以下代码：
```
<!-- 页面点击小红心 --> 
<script type="text/javascript" src="/js/src/love.js"></script>
```

## 设置网站图标

默认的网站图标是一个N，找一个图片将其放在`/themes/next/source/images`里面，
修改下面对应的名字
```
favicon:
  small: /images/favicon-16x16-next.png
  medium: /images/favicon-32x32-next.png # 这里
  apple_touch_icon: /images/apple-touch-icon-next.png
  safari_pinned_tab: /images/logo.svg
  #android_manifest: /images/manifest.json
  #ms_browserconfig: /images/browserconfig.xml
```

## 主页文章加阴影

打开`\themes\next\source\css\_custom\custom.styl,`向里面加入：
```
// 主页文章添加阴影效果
.post {
margin-top: 60px;
margin-bottom: 60px;
padding: 25px;
-webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);
-moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);
}
```

`\themes\next\source\css\_custom\custom.styl,`文件会覆盖所有自带的样式，可以放心的写自己的样式。不想要的时候直接删除就行，不会影响原有的样式。

## 添加“本文结束”标记

在 `\themes\next\layout\_macro` 中新建 `passage-end-tag.swig` 文件,并添加以下内容：
```
<div>
{% if not is_index %}
    <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
{% endif %}
</div>
```
接着打开\themes\next\layout\_macro\post.swig文件，在post-body 之后， 添加以下代码：
```
{#####################}
{### END POST BODY ###}
{#####################} 
在这个后面添加
	
<div>
{% if not is_index %}
{% include 'passage-end-tag.swig' %}
{% endif %}
</div>

```

## 修改作者头像并旋转

打开`\themes\next\source\css\_common\components\sidebar\sidebar-author.styl`，在里面添加如下代码：
```
.site-author-image {
  display: block;
  margin: 0 auto;
  padding: $site-author-image-padding;
  max-width: $site-author-image-width;
  height: $site-author-image-height;
  border: $site-author-image-border-width solid $site-author-image-border-color;

  /* 头像圆形 */
  border-radius: 80px;
  -webkit-border-radius: 80px;
  -moz-border-radius: 80px;
  box-shadow: inset 0 -1px 0 #333sf;

  /* 设置循环动画 [animation: (play)动画名称 (2s)动画播放时长单位秒或微秒 (ase-out)动画播放的速度曲线为以低速结束
    (1s)等待1秒然后开始动画 (1)动画播放次数(infinite为循环播放) ]*/
  animation: play 2s infinite;

  /* 鼠标经过头像旋转360度
  -webkit-transition: -webkit-transform 1.0s ease-out;
  -moz-transition: -moz-transform 1.0s ease-out;
  transition: transform 1.0s ease-out;*/
}

img:hover {
  /* 鼠标经过停止头像旋转*/
  -webkit-animation-play-state:paused;
  animation-play-state:paused;

  /* 鼠标经过头像旋转360度
  -webkit-transform: rotateZ(360deg);
  -moz-transform: rotateZ(360deg);
  transform: rotateZ(360deg); */
}

/* Z 轴旋转动画 */
@-webkit-keyframes play {
  0% {
    -webkit-transform: rotateZ(0deg);
  }
  100% {
    -webkit-transform: rotateZ(-360deg);
  }
}
@-moz-keyframes play {
  0% {
    -moz-transform: rotateZ(0deg);
  }
  100% {
    -moz-transform: rotateZ(-360deg);
  }
}
@keyframes play {
  0% {
    transform: rotateZ(0deg);
  }
  100% {
    transform: rotateZ(-360deg);
  }
}
```

## 添加统计

在`next\_config.yml`文件找到
```
busuanzi_count:
  enable: true  # 设置为true即可
  total_visitors: true
  total_visitors_icon: user
  total_views: true
  total_views_icon: eye
  post_views: true
  post_views_icon: eye
  people: 人数
  number: 数量

```
自定义页脚，相关文件themes\next\layout\_third-party\analytics\busuanzi-counter.swig
```
{% if theme.busuanzi_count.total_visitors %}
<span class="site-uv" title="{{ __('footer.total_visitors') }}">
 这里 {{ theme.busuanzi_count.people }} 到这 <i class="fa fa-{{ theme.busuanzi_count.total_visitors_icon }}"></i>
  <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
</span>
{% endif %}

{% if theme.busuanzi_count.total_views %}
<span class="site-pv" title="{{ __('footer.total_views') }}">
 这里 {{ theme.busuanzi_count.number }} 到这 <i class="fa fa-{{ theme.busuanzi_count.total_views_icon }}"></i>
  <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
</span>
{% endif %}
```
之后想要改文字直接在next里改就行了。

## 文章加密访问

如果写点日记什么的还有用，不然纯属好玩。
打开`themes/next/layout/_partials/head/head.swig`文件,在以下位置插入这样一段代码：
```
<script>
    (function(){
        if('{{ page.password }}'){
            if (prompt('请输入文章密码') !== '{{ page.password }}'){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>
```
在写文章的时候加上`password`如下：
```
---
title: Hexo Next5.x 升级6.x 
date: 2018-10-06 12:53:31
tags: [Hexo]
categories: Hexo
password: 123456
---
```

## 文章置顶

```
---
title: Hexo Next5.x 升级6.x 
date: 2018-10-06 12:53:31
tags: [Hexo]
categories: Hexo
password: 123456
top: true  //添加top属性设置为true即可
---
```

__推荐一个大佬的文章__
[点击跳转](https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html)